<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nightmare Peggle â€” Horror Edition</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
      background: #07070a; color: #ececf1;
      font: 14px/1.4 Inter, ui-sans-serif, system-ui;
    }
    .wrap { display: flex; flex-direction: column; height: 100%; }
    header, footer {
      background: #0b0b0e; border-bottom: 1px solid #1a1a1f;
      padding: .5rem 1rem; display: flex; align-items: center; gap: .5rem;
    }
    header h1 { font-size: 12px; text-transform: uppercase; opacity: .9; margin: 0; }
    .sp { flex: 1; }
    .btn, select {
      cursor: pointer; border: 1px solid #2a2a33; background: #121218;
      border-radius: 8px; padding: .35rem .7rem; color: #eaeaf0;
    }
    .btn:hover { background: #1a1a24; }
    .danger { border-color:#3a1820; background:#17060a; color:#fecaca; }
    .hud { display: flex; gap: .75rem; align-items: center; flex-wrap: wrap; }
    .badge { padding: .2rem .6rem; border: 1px solid #24242a; border-radius: 6px; background: #0f0f12; }
    .meter { flex:1; height:10px; margin-left:1rem; border-radius:999px; background:#111214; border:1px solid #222; position:relative; overflow:hidden; }
    .meter>i { position:absolute; inset:0; background:linear-gradient(90deg,#e11d48,#f43f5e); transform-origin:left center; }
    main { flex:1; display:flex; justify-content:center; align-items:center; }
    canvas { background:#0a0a0c; border:1px solid #1b1b1f; border-radius:12px; max-width:100%; height:auto; }
    .overlay { position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; }
    .menu { pointer-events:auto; display:flex; flex-direction:column; align-items:center; gap:16px; background:rgba(10,10,12,.8); padding:28px; border:1px solid #222; border-radius:14px; text-align:center; }
    .title { font:800 42px/1.1 "Cinzel", serif; letter-spacing:.05em; text-transform:uppercase; text-shadow:0 0 18px #a00; }
    .flash { animation:flash 1.6s infinite; }
    @keyframes flash{0%,60%{opacity:.25}70%{opacity:.8}100%{opacity:.25}}
    /* Jump scare */
    #jumpscare{position:fixed; inset:0; background:black; display:none; justify-content:center; align-items:center; z-index:9999; animation:fadeIn .2s;}
    #jumpscare img{max-width:100%; max-height:100%;}
    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Nightmare Peggle</h1>
      <div class="sp"></div>
      <select id="quality"><option>Low</option><option selected>Med</option><option>High</option></select>
      <button id="muteBtn" class="btn">ðŸ”Š</button>
      <button id="bloodBtn" class="btn">ðŸ©¸ Blood On</button>
      <button id="resetBtn" class="btn danger">âŸ² Reset</button>
    </header>
    <main>
      <div style="position:relative;">
        <canvas id="game" width="960" height="640"></canvas>
        <div class="overlay" id="uiOverlay"></div>
      </div>
    </main>
    <footer>
      <div class="hud">
        <span class="badge">Level: <b id="levelLabel">1</b></span>
        <span class="badge">Balls: <b id="ballsLabel">10</b></span>
        <span class="badge">Streak: <b id="streakLabel">0</b></span>
        <span class="badge">Score: <b id="scoreLabel">0</b></span>
        <span class="badge">Fear: <b id="fearLabel">0%</b></span>
        <span class="badge">Power: <b id="powerLabel">â€”</b></span>
      </div>
      <div class="meter"><i id="progressFill"></i></div>
    </footer>
  </div>
  <div id="jumpscare"><img src="https://i.imgur.com/1R8zn4Y.jpeg" alt="Scary face"></div>

<script>
(() => {
  const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
  const W=canvas.width,H=canvas.height,ui=document.getElementById('uiOverlay');
  const ballsLabel=document.getElementById('ballsLabel'),scoreLabel=document.getElementById('scoreLabel'),
        streakLabel=document.getElementById('streakLabel'),levelLabel=document.getElementById('levelLabel'),
        fearLabel=document.getElementById('fearLabel'),powerLabel=document.getElementById('powerLabel'),
        progressFill=document.getElementById('progressFill');
  const muteBtn=document.getElementById('muteBtn'),resetBtn=document.getElementById('resetBtn'),
        bloodBtn=document.getElementById('bloodBtn'),qualitySel=document.getElementById('quality');

  let audioEnabled=true,bloodEnabled=true;
  muteBtn.onclick=()=>{audioEnabled=!audioEnabled;muteBtn.textContent=audioEnabled?'ðŸ”Š':'ðŸ”‡';};
  bloodBtn.onclick=()=>{bloodEnabled=!bloodEnabled;bloodBtn.textContent=bloodEnabled?'ðŸ©¸ Blood On':'ðŸ©¸ Blood Off';};

  // jump scare
  function triggerJumpscare(){
    if(!audioEnabled) return;
    const js=document.getElementById('jumpscare'); js.style.display='flex';
    const scream=new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg");
    scream.volume=0.6; scream.play();
    setTimeout(()=>{js.style.display='none';},1000);
  }

  // world
  const world={ballsLeft:10,score:0,streak:0,level:1,fear:0,decals:[],ball:null,pegs:[]};

  function updateHUD(){
    ballsLabel.textContent=world.ballsLeft;
    scoreLabel.textContent=Math.floor(world.score);
    streakLabel.textContent=world.streak;
    levelLabel.textContent=world.level;
    fearLabel.textContent=Math.round(world.fear)+'%';
    powerLabel.textContent='â€”';
    progressFill.style.transform=`scaleX(${world.fear/100})`;
  }

  function resetBlood(){world.decals=[];}
  resetBtn.onclick=()=>{resetBlood();loadLevel(world.level);};

  function loadLevel(i){
    resetBlood(); world.level=i; world.fear=Math.max(0,world.fear-10);
    world.pegs=[...Array(20)].map((_,k)=>({x:100+40*k%800,y:120+Math.floor(k/10)*60,r:20,hit:false,type:k%5==0?'cursed':'normal'}));
    updateHUD();
  }
  loadLevel(1);

  class Ball{constructor(x,y,vx,vy){this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.r=14;this.dead=false;this.life=120;}
    step(){this.vy+=0.34;this.vx*=0.995;this.vy*=0.995;this.x+=this.vx;this.y+=this.vy;
      if(this.y>H-this.r){this.life-=2;if(this.life<=0)this.dead=true;}}
    draw(){ctx.beginPath();ctx.fillStyle='#eee';ctx.arc(this.x,this.y,this.r,0,7);ctx.fill();}
  }

  let mouse={x:W/2,y:60,down:false};
  canvas.addEventListener('mousemove',e=>{const r=canvas.getBoundingClientRect();mouse.x=e.clientX-r.left;mouse.y=e.clientY-r.top;});
  canvas.addEventListener('mousedown',()=>{if(!world.ball&&world.ballsLeft>0){world.ball=new Ball(W/2,60,(mouse.x-W/2)/20,(mouse.y-60)/20);world.ballsLeft--;}});

  function loop(){requestAnimationFrame(loop);
    ctx.clearRect(0,0,W,H);
    // draw pegs
    for(const p of world.pegs){if(p.hit)continue;ctx.fillStyle=p.type==='cursed'?'#d22':'#c66';ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,7);ctx.fill();}
    // ball
    if(world.ball){world.ball.step();world.ball.draw();if(world.ball.dead){world.ball=null;}}
    // fear effects
    if(world.fear>60&&Math.random()<0.002){triggerJumpscare();}
    updateHUD();
  }
  loop();

  // resize
  function resizeCanvas(){const aspect=W/H;let ww=window.innerWidth,wh=window.innerHeight-100;
    let cw=ww,ch=Math.floor(ww/aspect);if(ch>wh){ch=wh;cw=Math.floor(ch*aspect);}
    canvas.style.width=cw+"px";canvas.style.height=ch+"px";}
  window.addEventListener('resize',resizeCanvas);resizeCanvas();
})();
</script>
</body>
</html>
